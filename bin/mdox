#!/usr/bin/env node

var pkg = require('../package');
var util = require('util');
var mdox = require('..');
var argv = require('optimist')
    .boolean('help')
    .string('doc')
    .boolean('html')
    .boolean('md')
    .boolean('debug')
    .alias('d', 'debug')
    .alias('h', 'help')
    .describe('d', 'output parsed comments for debugging')
    .describe('h', 'output help')
    .argv;

if (argv.help) {
    console.log('  Examples:');
    console.log('');
    console.log('    # stdin');
    console.log('    $ mdox > myfile.json');
    console.log('');
    console.log('    # operates over stdio');
    console.log('    $ mdox < myfile.js > myfile.json');
    console.log('');

} else if (argv.doc) {


} else {
    var buf = '';
    process.stdin.setEncoding('utf8');
    process.stdin.on('data', function(chunk) {
        buf += chunk;
    });

    process.stdin.on('end', function() {
        if (argv.html) {
            process.stdout.write(mdox.htmlGenerate(buf));

        } else if (argv.md) {
            process.stdout.write(mdox.mdGenerate(buf));

        } else {
            var data = mdox.jsonGenerate(buf);

            if (argv.debug) {
                process.stdout.write(util.inspect(data, {
                    showHidden: false,
                    depth: Infinity,
                    colors: true
                }) + '\n');

            } else {
                process.stdout.write(JSON.stringify(data, null, 4));
            }
        }

    });

    process.stdin.resume();
}
